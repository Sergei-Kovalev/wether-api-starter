# Weather API Starter

Проект создан как тестовое задание для ООО Kameleoon.

## Содержание
1. [Используемый стек](#используемый-стек)
2. [Общее описание](#общее-описание)
3. [Инструкция по запуску](#инструкция-по-запуску)
4. [Описание предоставляемых методов](#описание-предоставляемых-методов)

## Используемый стек
1. Java 17
2. Gradle (в требовании не было указано - мог бы и Maven)
3. Lombok
4. Mapstruct
5. AssertJ

## Общее описание
SDK реализовано в виде стартера, который можно подключить к своему проекту и с помощью методов, предоставляемых сервисом стартера, получать данные о погоде в городе.

Стартер содержит кэш, хранящий последние данные о погоде по городам, которые запрашивались последними (реализован по алгоритму LRU). Вместимость кэша - 10 объектов.

Реализована возможность получать погоду по наименованию города, по наименованию города и API ключу для [OpenWeatherMap API](https://openweathermap.org/api), а также возможность удаления данных из кэша (по наименованию города).

Может работать в режиме on-demand или в polling mode.

Данные кэша считаются актуальными, если их timestamp отличается от текущего не более 10 минут.

## Инструкция по запуску
- Скачать проект.
- Запустить в Gradle таску `publishing/publishToMavenLocal` для генерации артефакта в локальный репозиторий (аналог операции Maven install).
- Стартер готов к использованию в Вашем проекте.
- **Важное замечание**: для работы в polling mode, кроме включения соответствующей опции в настройках стартера, необходимо в Вашем приложении добавить `@EnableScheduling` (не реализовано принудительное включение, для отсутствия сайд эффектов в Вашем приложении).
- При необходимости настроить параметры стартера. По умолчанию работает в режиме on-demand с преднастроенным ключом для API. Пример параметров в `application.yaml`:

  ```yaml
  weather-api-starter:
    api-key: someApiKey
    polling-mode: false (по умолчанию работает в режиме on-demand)

- PS: сгенерированный стартер также можно положить в Ваш корпоративный репозиторий (например Nexus) для использования несколькими разработчиками. 

## Описание предоставляемых методов
Основной класс сервиса, предоставляющий метода - это WeatherService
Предоставляемые методы:
1. getWeather(String city) - предоставляет данные о погоде по выбранному городу в формате JSON.
   Пример ответа:
~~~
   {
      "weather" : {
        "main" : "Clear",
        "description" : "clear sky"
   },
      "temperature" : {
        "temp" : 268.26,
        "feels_like" : 264.48
   },
      "visibility" : 10000,
      "wind" : {
        "speed" : 2.38
   },
   "datetime" : 1740468426,
    "sys" : {
      "sunrise" : 1740460058,
      "sunset" : 1740497902
   },
   "timezone" : 10800,
   "name" : "Minsk City"
   }
~~~
   Возможные ошибки, которые необходимо перехватить в Вашем приложении:
   - ApiKeyNotValidException - пользователь указал неверный API key.
   - CityNameNotValidException - пользователь указал наименование города, которое не найдено.
   - WeatherFromApiNotFoundException - данные о погоде не найдены.
2. getWeatherWithAnotherApiKey(String city, String appid) - предоставляет данные о погоде по выбранному городу в формате JSON. Аналогичен первому, только предоставляет возможность зайти пользователю с другим ключом. Ответы и ошибки те же.
3. deleteWeatherInfo(String city) - удаляет из кэша данные о погоде по указанному городу.